#!/usr/bin/env zsh

set -euo pipefail

# ç°¡å–® log helperï¼Œçµ±ä¸€è³‡è¨Šèˆ‡éŒ¯èª¤è¼¸å‡ºæ ¼å¼
info() { echo "[INFO] $*"; }
err()  { echo "[ERROR] $*" >&2; }

# å–å¾—è…³æœ¬æ‰€åœ¨ç›®éŒ„èˆ‡å°ˆæ¡ˆæ ¹ç›®éŒ„
SCRIPT_DIR="$(cd "$(dirname "$0")" >/dev/null 2>&1 && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." >/dev/null 2>&1 && pwd)"

info "==============================================="
info "é–‹å§‹å®Œæ•´å»ºåˆ¶èˆ‡éƒ¨ç½²æµç¨‹"
info "==============================================="

# 1. åŸ·è¡Œå‰ç«¯å»ºåˆ¶
info "ç¬¬ä¸€æ­¥ï¼šåŸ·è¡Œå‰ç«¯å»ºåˆ¶..."
if "$SCRIPT_DIR/build_frontend.sh"; then
    info "âœ… å‰ç«¯å»ºåˆ¶æˆåŠŸ"
else
    err "âŒ å‰ç«¯å»ºåˆ¶å¤±æ•—"
    err "==============================================="
    err "å»ºåˆ¶æµç¨‹ä¸­æ–·"
    err "==============================================="
    exit 1
fi

echo ""

# 2. åŸ·è¡Œå¾Œç«¯å»ºåˆ¶
info "ç¬¬äºŒæ­¥ï¼šåŸ·è¡Œå¾Œç«¯å»ºåˆ¶..."
if "$SCRIPT_DIR/build_backend.sh"; then
    info "âœ… å¾Œç«¯å»ºåˆ¶æˆåŠŸ"
else
    err "âŒ å¾Œç«¯å»ºåˆ¶å¤±æ•—"
    err "==============================================="
    err "å»ºåˆ¶æµç¨‹ä¸­æ–·"
    err "==============================================="
    exit 1
fi

echo ""
info "==============================================="
info "ğŸ‰ å®Œæ•´å»ºåˆ¶èˆ‡éƒ¨ç½²æµç¨‹å®Œæˆ"
info "==============================================="
