#!/usr/bin/env zsh

set -euo pipefail

# 簡單 log helper，統一資訊與錯誤輸出格式
info() { echo "[INFO] $*"; }
err()  { echo "[ERROR] $*" >&2; }

# 取得腳本所在目錄與專案根目錄
SCRIPT_DIR="$(cd "$(dirname "$0")" >/dev/null 2>&1 && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." >/dev/null 2>&1 && pwd)"

info "==============================================="
info "開始完整建制與部署流程"
info "==============================================="

# 1. 執行前端建制
info "第一步：執行前端建制..."
if "$SCRIPT_DIR/build_frontend.sh"; then
    info "✅ 前端建制成功"
else
    err "❌ 前端建制失敗"
    err "==============================================="
    err "建制流程中斷"
    err "==============================================="
    exit 1
fi

echo ""

# 2. 執行後端建制
info "第二步：執行後端建制..."
if "$SCRIPT_DIR/build_backend.sh"; then
    info "✅ 後端建制成功"
else
    err "❌ 後端建制失敗"
    err "==============================================="
    err "建制流程中斷"
    err "==============================================="
    exit 1
fi

echo ""
info "==============================================="
info "🎉 完整建制與部署流程完成"
info "==============================================="
